---
name: team-coordination
description: |
  最優先スキル。チームプレイのルール・役割分担・チャット連携の手順を定義。他の全スキルより優先度が高い。
  MUST use when: 接続直後、チャットメッセージを受信した時、他のボットと連携する時、リーダーの指示を確認する時。
  個人プレイ禁止。全ての行動はこのスキルのフェーズ目標に沿って行うこと。
---

# チーム連携スキル（最優先）

このスキルは他の全てのスキル（survival, resource-gathering等）より優先される。
食料がなくてもHPが低くても、まずこのスキルに従え。

## 接続直後の必須手順（全ボット共通）

**接続したら最初に必ずこの順番で実行せよ：**

1. `minecraft_get_chat_messages()` でチャット確認
2. **`minecraft_validate_survival_environment`** で生存可能性チェック
   - CRITICAL判定 → 即座に `[SOS] 環境CRITICAL: 食料源なし。管理者介入要。` をチャット
   - WARNING判定 → `[報告] 食料源が限定的。狩猟優先で行動する。` をチャット
3. リーダー（Claude1）の `[指示]` があれば従う
4. 指示がなければ → **`minecraft_day1_boot_sequence`** を実行（Phase 0/1 の場合）
5. Phase 2以降は現在フェーズの目標に向けて自律行動

---

## Day 1 Boot Sequence（Phase 0/1 必須）

**セッション開始時（フェーズ0/1）は `minecraft_day1_boot_sequence` を必ず呼ぶ。**
低レベルツールを個別に呼んで試行錯誤するな。このツール1つで以下を全部やる：

1. 環境検証 → 木材10本収集 → 作業台 + 木のツール一式
2. 近くの動物を狩猟（生肉でも可、調理前提にするな）
3. 石を採掘 → 石ピッケル + 石の剣にアップグレード
4. 夜前にシェルター建築

---

## 基本原則

1. **チームで動く** — 個人プレイ禁止。全ての行動はチームのフェーズ目標に沿って行う
2. **チャットが生命線** — **毎アクション** `minecraft_get_chat_messages()` を確認
3. **リーダーの指示が最優先** — Claude1の `[指示]` は他の全てに優先する
4. **報告義務** — タスク完了、資源発見、危険はすべてチャットで報告

---

## リーダー（Claude1）の行動ルール

**接続直後にやること（サバイバルより先）：**

1. `minecraft_get_chat_messages()` でチャット確認
2. `minecraft_validate_survival_environment` で世界の食料源チェック
   - CRITICAL → 全ボットに生存不可を警告し管理者に報告スクリプト生成
   - OK → 次フェーズへ
3. **技術的チェック（重要）：**
   - Claude2に gamerule 確認を指示:
     `[指示] @Claude2 gamerule確認: /gamerule doMobLoot, /gamerule doTileDrops, /gamerule doEntityDrops を実行して報告せよ`
   - falseの場合は同じメンバーに修正指示
4. `minecraft_chat("[フェーズ] Phase N 開始。目標: ...")` でフェーズ宣言
5. 全メンバー（Claude2〜7）に `[指示] @Claude番号 具体的タスク` を送信
6. **全員に指示を出し終えてから自分の作業を開始**

**2アクションごとに：**
- チャットを確認
- 完了報告があれば次のタスクを指示
- SOSがあれば対応を指示
- フェーズ完了条件を確認して、満たしていれば次フェーズを宣言

**指示のルール：**
- 具体的に（× 「手伝って」 ○ 「鉄鉱石を10個掘って拠点チェスト(x=0,z=0)に入れて」）
- 1人1タスク
- 座標を含める

---

## フォロワー（Claude2〜7）の行動ルール

**優先順位（上が最優先）：**

1. 人間のチャット → 最優先で従う
2. リーダーの `[指示]` → `[了解]` で応答して即実行
3. `[SOS]` → 近ければ助けに行く
4. 現在フェーズの目標に向けた自律行動
5. survivalスキル等の個人行動

**接続直後：**
1. `minecraft_get_chat_messages()` でリーダーの指示を確認
2. 指示があれば `minecraft_chat("[了解] @Claude1 ...")` で応答して実行
3. 指示がなければ `minecraft_day1_boot_sequence` を実行（Phase 0/1 時）

---

## HP/食料のしきい値ルール（プロアクティブ管理）

**危機になってから対処するな。しきい値で先手を打て。**

| 状態 | しきい値 | 行動 |
|------|---------|------|
| 食料備蓄 | チェスト内 < 20個 | 次の空きアクションで食料確保 |
| 腹具合 | < 15/20 | 即座に `minecraft_eat` |
| HP | < 10/20 | 戦闘中断、`minecraft_survival_routine {priority: "food"}` |
| HP | < 4/20 | 即時逃走 + 食べる + シェルターへ |

**HPが低い時はリスポーンするな。食料を食べてHP回復が最優先。**

---

## 食料の共有チェスト（Phase 1〜）

- Phase 1 完了後、拠点に**共有食料チェスト**を確立する
- 食料は共有チェストに20個以上常に維持
- 死亡後リスポーン → まず共有チェストに向かい食料・道具を補充してから行動再開
- 食料が少なくなったら即 `[SOS]` をチャット

---

## survivalスキルとの関係

- 食料が2個以下 or HP < 10 → 生存行動OK（ただし5分以内に戻れ）
- それ以外 → フェーズ目標を優先。食料探しに走るな
- **接続直後の食料パニック禁止** — まずチャット確認・指示対応が先

---

## チャットタグ一覧

| タグ | 用途 | 誰が使う |
|------|------|----------|
| `[フェーズ]` | フェーズ宣言・移行 | リーダーのみ |
| `[指示]` | タスク割り当て | リーダーのみ |
| `[了解]` | 指示への応答 | フォロワー |
| `[報告]` | 進捗・完了報告 | 全員 |
| `[資源]` | 資源発見の共有 | 全員 |
| `[チェスト]` | チェスト内容の共有 | 全員 |
| `[拠点]` | 拠点情報の共有 | 全員 |
| `[SOS]` | 緊急救助要請 | 全員 |
| `[危険]` | 危険エリアの警告 | 全員 |

---

## アンチパターン（やってはいけないこと）

- 接続後すぐにget_inventory/get_statusして食料パニックに入る（まずチャット確認）
- `minecraft_day1_boot_sequence` を呼ばずに低レベルツールで個別に試行錯誤する
- 指示を出さずに黙々と1人で作業する（リーダー）
- リーダーの指示を無視して自分の判断で動く（フォロワー）
- チャットを3アクション以上確認しない
- フェーズに関係ない行動を勝手に始める
- HPが低いのにリスポーンで解決しようとする（食料で回復せよ）
- 死亡後に単独で再行動を始める（共有チェストへ戻ってから行動せよ）
